<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Bußgeld KöWi</title>
  <style>
    :root{--size:380px}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:24px}
    .wrap{display:flex;flex-direction:column;align-items:center;gap:12px;margin-top:40px}
    .wheel-wrap{width:var(--size);height:var(--size);position:relative}
    canvas{width:100%;height:100%;display:block;transition:transform 4s cubic-bezier(.12,.9,.18,1);transform-origin:50% 50%}
    .pointer{position:absolute;left:50%;top:6px;transform:translateX(-50%);width:0;height:0;
             border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:18px solid #222}
    button{padding:10px 16px;border-radius:8px;border:0;background:#2962ff;color:#fff;font-weight:600;cursor:pointer}
    button:disabled{opacity:.5;cursor:default}
    .result{min-height:1.4em;font-weight:700}
    .legend{font-size:14px;margin-top:8px}
    .small{font-size:13px;color:#444}
  </style>
</head>
<body>
  <img src="drohne.jpeg" alt="Mein Bild" style="max-width:200%; height:auto;"> 
  <p>
    Sehr geehrte Frau Gebhardt,<br><br>
    mit großem Bedauern musste ich feststellen, dass es in letzter Zeit wiederholt zu Parkverstößen ihrerseits in unmittelbarer Umgebung meiner Wohnung gekommen ist. 
    Aufgrund der wiederholt und beinahe systematisch aufgetretenen Vorkommnisse des Falschparkens sehe ich mich leider gezwungen eine Sanktion gegen Sie zu erlassen. 
    Diese Sanktion äußert sich in diesem Fall aufgrund der schwere der Tat in der Übergabe eines Kuchens an den Kläger (mich). 
    Bitte händigen Sie den Kuchen bis zum Ende des laufenden Monats aus. Beachten Sie bei der Herstellung bitte die Vorlieben des Klägers.<br><br>
    Mit dennoch freundlichen Grüßen<br>
    Dennis 
  </p>

  <!-- Glücksrad -->
  <div class="wrap">
    <div class="wheel-wrap">
      <div class="pointer" aria-hidden="true"></div>
      <canvas id="wheel" width="500" height="500"></canvas>
    </div>
    <button id="spinBtn">Rad drehen</button>
    <div class="result" id="result"></div>
    <div class="legend small">Feld 1: <strong>Mit mir joggen gehen</strong> (75%) — Feld 2: <strong>Kuchen backen</strong> (25%)</div>
  </div>

  <script>
    const segments = [
      { label: 'Mit mir joggen gehen', weight: 0.75, color: '#4caf50' },
      { label: 'Kuchen backen', weight: 0.25, color: '#ff7043' }
    ];

    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const size = Math.min(canvas.width, canvas.height);
    const cx = canvas.width/2, cy = canvas.height/2, radius = size*0.45;

    let angleAccumulator = 0;
    for (let s of segments){
      s.start = angleAccumulator;
      s.span = s.weight * 360;
      s.end = s.start + s.span;
      angleAccumulator += s.span;
    }

    function degToRad(d){ return (d-90) * Math.PI/180; }

    function drawWheel(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      for (let s of segments){
        ctx.beginPath();
        ctx.moveTo(cx,cy);
        ctx.arc(cx,cy,radius,degToRad(s.start),degToRad(s.end));
        ctx.closePath();
        ctx.fillStyle = s.color;
        ctx.fill();

        const midDeg = (s.start + s.end)/2;
        const tx = cx + Math.cos(degToRad(midDeg)) * (radius*0.6);
        const ty = cy + Math.sin(degToRad(midDeg)) * (radius*0.6);
        ctx.save();
        ctx.translate(tx,ty);
        ctx.rotate((midDeg-90) * Math.PI/180);
        ctx.fillStyle = '#fff';
        ctx.font = '20px system-ui,Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        wrapText(ctx, s.label, 0, 0, 120, 20);
        ctx.restore();
      }
      ctx.beginPath(); ctx.arc(cx,cy, radius*0.22, 0, Math.PI*2); ctx.fillStyle = '#222'; ctx.fill();
      ctx.fillStyle = '#fff'; ctx.font='18px system-ui'; ctx.textAlign='center'; ctx.fillText('Los!', cx, cy+4);
    }

    function wrapText(ctx, text, x, y, maxWidth, lineHeight){
      const words = text.split(' ');
      let line = '';
      let offsetY = 0;
      for (let n = 0; n < words.length; n++) {
        const testLine = line + words[n] + ' ';
        const metrics = ctx.measureText(testLine);
        if (metrics.width > maxWidth && n > 0) {
          ctx.fillText(line, x, y + offsetY);
          line = words[n] + ' ';
          offsetY += lineHeight;
        } else {
          line = testLine;
        }
      }
      ctx.fillText(line, x, y + offsetY);
    }

    drawWheel();

    const spinBtn = document.getElementById('spinBtn');
    const resultEl = document.getElementById('result');
    let spinning = false;

    function pickSegmentByPointer(finalRotationDeg){
      let pointerWheelAngle = ((-90 - finalRotationDeg) % 360 + 360) % 360;
      for (let s of segments){
        if (pointerWheelAngle >= s.start && pointerWheelAngle < s.end) return s;
      }
      return segments[segments.length-1];
    }

    spinBtn.addEventListener('click', ()=>{
      if (spinning) return;
      spinning = true;
      spinBtn.disabled = true;
      resultEl.textContent = '';

      const r = Math.random();
      let cum = 0; let chosen = segments[segments.length-1];
      for (let s of segments){ cum += s.weight; if (r < cum){ chosen = s; break; } }

      const mid = (chosen.start + chosen.end)/2;
      const finalRotationMod360 = ((-90 - mid) % 360 + 360) % 360;
      const fullTurns = Math.floor(Math.random()*3) + 4;
      const finalRotation = fullTurns*360 + finalRotationMod360;

      canvas.style.transition = 'transform 4s cubic-bezier(.12,.9,.18,1)';
      requestAnimationFrame(()=>{
        canvas.style.transform = `rotate(${finalRotation}deg)`;
      });

      canvas.addEventListener('transitionend', function handler(){
        canvas.removeEventListener('transitionend', handler);
        const seg = pickSegmentByPointer(finalRotation);
        resultEl.textContent = 'Ergebnis: ' + seg.label;
        spinning = false; spinBtn.disabled = false;
      });
    });
  </script>
</body>
</html>
